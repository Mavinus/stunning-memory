<html>
	<head>
		<title>Zadanie 4,5</title>
		<style>
			td
			{
				border: 1px solid black;
			}

			#score
			{
				color: red;
				font-size: 30px;
				position: fixed;
				right: 10%;
				top: 4%;
			}

			#time
			{
				color: red;
				font-size: 30px;
				position: fixed;
				right: 10%;
				top: 10%;
			}
		</style>
	</head>
	<body>
		<div id="buttons">
			<button onclick="memory(4)">Poziom łatwy (4x4)</button>
			<button onclick="memory(6)">Poziom średni (6x6)</button>
			<button onclick="memory(8)">Poziom trudny (8x8)</button>
			<button onclick="memory(16)">Poziom: Azjata (16x16)</button>
		</div>
		<div id="score">SCORE: 0</div>
		<div id="time"></div>
		<div id="game"></div>
		<script>
			/*
			4,5. Napisz funkcję memory, która wyświetli tabelkę 4x4 z obrazkami w każdym okienku. Obrazków jest 8 i powtarzają sie maksymalnie raz. Po 10 sekundach wszystkie obrazki zamieniane są na czarne pola. Użytkownik klika na wybrany czarny obrazek i pojawia sie obrazek kolorowy, w tym czasie ma 5 sekund aby kliknąć kolejny czarny obrazek. Jeśli nie zdążył odsłonięty obrazek znów staje się czarny. Jeśli odsłonił kolejny obrazek i zgadza się on z poprzednio odsłoniętym zostaje dodany punkt, a obrazki już nie zmieniają koloru na czarny. Cały czas w prawym górnym rogu okna wyświetla się punktacja oraz czas do zakończenia gry (np. 10 minut na całą grę). Gra kończy się po 10 minutach lub kiedy użytkownik odkryje poprawnie wszystkie pola.
			*/

			function memory(difficulty)
			{
				if(typeof a!="undefined" || typeof b!="undefined")
				{
					clearTimeout(a);
					clearInterval(b);
				}

				texturePath = new Array();
				revealedCard = new Array();
				revealedForever = new Array();
				revealed = 0;
				timeMinutes=10;
				timeSeconds=0;
				points=0;

				document.getElementById("game").innerHTML = "<table>"+tdtr(difficulty)+"</table>";

				td = document.getElementsByTagName("td");

				for(let k=0; k<difficulty*difficulty; k+=difficulty*difficulty/2)
					for(let i=0;i<difficulty*difficulty/2;i++)					
						texturePath[i+k] = "./textures/"+(i+1)+".jpg";
				
				shuffle(texturePath);


				for(let i=0; i<difficulty*difficulty; i++)
				{
					td[i].setAttribute("style","background-image:url("+texturePath[i]+"); background-repeat: no-repeat; background-size: 100px 100px; width: 100px; height: 100px; background-color: black");
					td[i].setAttribute("onclick","clicked("+i+")");
				}

				a=setTimeout(blackAllOut,1000);
				b=setInterval(timeToEnd,1000);
			}

			function tdtr(d)
			{
				var kwa;

				for(let k=0;k<d;k++)
				{
					kwa+="<tr>";
						for(let i=0;i<d;i++)
							kwa+="<td></td>";
					kwa+="</tr>";
				}
				return kwa;
			}

			function shuffle(ary)
			{
				var j,
					x;
			    for (let i = ary.length - 1; i > 0; i--)
			    {
			        j = Math.floor(Math.random() * (i + 1))
			        x = ary[i];
			        ary[i] = ary[j];
			        ary[j] = x;
			    }
			}

			function blackAllOut()
			{
				tdStyle = new Array();
				tdStyleEdited = new Array();
				
				for(let i=0;i<td.length;i++)
				{
					tdStyle[i] = td[i].getAttribute("style");
					tdStyleEdited[i] = tdStyle[i].replace("background-image:url("+texturePath[i]+");", "");
					td[i].setAttribute("style", tdStyleEdited[i]);
				}
			}

			function blackOut(what)
			{
				td[what].setAttribute("style", tdStyleEdited[what]);
			}

			function clicked(what)
			{
				td[what].setAttribute("style",tdStyle[what]);
				revealedCard[revealed] = what;
				revealed++;

				if(revealed==1)
					timeUntilBlackedOut=setTimeout(function()
						{
							blackOut(revealedCard[0]);
							revealed=0;
						}
						,5000);

				if(revealed>=2)
				{
					if(tdStyle[revealedCard[0]]==tdStyle[revealedCard[1]] && alreadyRevealedCheck())
						{
							revealedForever[points]=revealedCard[0];
							points++;
							revealedForever[points]=revealedCard[1];
						}
					else
					{
						setTimeout(function () {blackOut(revealedCard[0])}, 400);
						setTimeout(function () {blackOut(revealedCard[1])}, 400);
					}
					revealed=0;
					clearTimeout(timeUntilBlackedOut);
				}
				document.getElementById("score").innerHTML = "SCORE: " + points;

				if(points>=td.length/2)
					kill(true);
				
			}

			function alreadyRevealedCheck()
			{
				var test=true;
				if(points>0)
				{
					for(let k=0;k<2;k++)								
						for(let i=0;i<revealedForever.length;i++)
							if(revealedCard[k]!=revealedForever[i])
								test=true;
							else
								return false;
				}
				return test;
			}

			function timeToEnd()
			{
				if(timeSeconds<=0)		
				{
					timeSeconds=60;
					timeMinutes--;
				}

				timeSeconds--;

				document.getElementById("time").innerHTML ="Pozostały czas: " + zero(timeMinutes)+":"+zero(timeSeconds);

				if(timeSeconds<=0 && timeMinutes<=0)
					kill(false);
			}

			function zero(kwa)
			{
				if(kwa<10)
					kwa = "0"+kwa;
				return kwa;
			}

			function kill(result)
			{
				if(result)
					document.getElementById("game").innerHTML = "WYGRAŁEŚ!!!1!!";
				else
					document.getElementById("game").innerHTML = "Przegrałeś :(";

				clearTimeout(a);
				clearInterval(b);
			}
			</script>
	</body>
</html>